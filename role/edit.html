<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="utf-8" />
		<title>Greeva - Responsive Bootstrap 4 Admin Dashboard</title>
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<meta content="A fully featured admin theme which can be used to build CRM, CMS, etc." name="description" />
		<meta content="Coderthemes" name="author" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />

		<!-- App favicon -->
		<link rel="shortcut icon" href="../assets/images/favicon.ico">
		
		<!-- Sweet Alert css -->
        <link href="../assets/libs/sweetalert2/sweetalert2.min.css" rel="stylesheet" type="text/css" />

		<!-- Icons css -->
		<link href="../assets/libs/@mdi/font/css/materialdesignicons.min.css" rel="stylesheet" type="text/css" />
		<link href="../assets/libs/dripicons/webfont/webfont.css" rel="stylesheet" type="text/css" />
		<link href="../assets/libs/simple-line-icons/css/simple-line-icons.css" rel="stylesheet" type="text/css" />

		<!-- App css -->
		<!-- build:css -->
		<link href="../assets/css/app.css" rel="stylesheet" type="text/css" />
		<!-- endbuild -->

	</head>

	<body>

		<!-- Navigation Bar-->
		<header id="topnav">
			<nav class="navbar-custom">

				<div class="container-fluid">
					<ul class="list-unstyled topbar-right-menu float-right mb-0">

						<li class="dropdown notification-list">
							<!-- Mobile menu toggle-->
							<a class="navbar-toggle nav-link">
								<div class="lines">
									<span></span>
									<span></span>
									<span></span>
								</div>
							</a>
							<!-- End mobile menu toggle-->
						</li>

						<li class="dropdown notification-list">
							<a class="nav-link dropdown-toggle arrow-none" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
								<i class="dripicons-bell noti-icon"></i>
								<span class="badge badge-danger badge-pill noti-icon-badge">4</span>
							</a>
							<div class="dropdown-menu dropdown-menu-right dropdown-menu-animated dropdown-lg">

								<!-- item-->
								<div class="dropdown-item noti-title">
									<h5 class="m-0"><span class="float-right"><a href="" class="text-dark"><small>Clear All</small></a> </span>Notification</h5>
								</div>

								<div class="slimscroll noti-scroll">
									<!-- item-->
									<a href="javascript:void(0);" class="dropdown-item notify-item">
										<div class="notify-icon bg-warning"><i class="mdi mdi-comment-account-outline"></i></div>
										<p class="notify-details">Caleb Flakelar commented on Admin<small class="text-muted">1 min ago</small></p>
									</a>

									<!-- item-->
									<a href="javascript:void(0);" class="dropdown-item notify-item">
										<div class="notify-icon bg-info"><i class="mdi mdi-account-plus"></i></div>
										<p class="notify-details">New user registered.<small class="text-muted">5 hours ago</small></p>
									</a>

									<!-- item-->
									<a href="javascript:void(0);" class="dropdown-item notify-item">
										<div class="notify-icon"><img src="../assets/images/users/avatar-2.jpg" class="img-fluid rounded-circle" alt="" /> </div>
										<p class="notify-details">Cristina Pride</p>
										<p class="text-muted font-13 mb-0 user-msg">Hi, How are you? What about our next meeting</p>
									</a>

									<!-- item-->
									<a href="javascript:void(0);" class="dropdown-item notify-item">
										<div class="notify-icon bg-danger"><i class="mdi mdi-comment-account-outline"></i></div>
										<p class="notify-details">Caleb Flakelar commented on Admin<small class="text-muted">4 days ago</small></p>
									</a>

									<!-- item-->
									<a href="javascript:void(0);" class="dropdown-item notify-item">
										<div class="notify-icon"><img src="../assets/images/users/avatar-4.jpg" class="img-fluid rounded-circle" alt="" /> </div>
										<p class="notify-details">Karen Robinson</p>
										<p class="text-muted font-13 mb-0 user-msg">Wow that's great</p>
									</a>

									<!-- item-->
									<a href="javascript:void(0);" class="dropdown-item notify-item">
										<div class="notify-icon bg-primary"><i class="mdi mdi-heart"></i></div>
										<p class="notify-details">Carlos Crouch liked <b>Admin</b><small class="text-muted">13 days ago</small></p>
									</a>
								</div>

								<!-- All-->
								<a href="javascript:void(0);" class="dropdown-item text-center text-primary notify-item notify-all">
									View all <i class="fi-arrow-right"></i>
								</a>

							</div>
						</li>

						<li class="dropdown notification-list">
							<a class="nav-link dropdown-toggle nav-user" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
								<span class="ml-1" id="userName" style="font-size: 26px;">AAAdmin<i class="mdi mdi-chevron-down"></i> </span>
							</a>
							<div class="dropdown-menu dropdown-menu-right dropdown-menu-animated profile-dropdown ">
								<!-- item-->
								<div class="dropdown-item noti-title">
									<h6 class="text-overflow m-0">欢迎 !</h6>
								</div>

								<!-- item-->
								<a href="javascript:void(0);" class="dropdown-item notify-item">
									<i class="dripicons-user"></i> <span>账号管理</span>
								</a>

								<!-- item-->
								<a href="javascript:void(0);" class="dropdown-item notify-item">
									<i class="dripicons-gear"></i> <span>个人设置</span>
								</a>

								<!-- item-->
								<a href="javascript:void(0);" class="dropdown-item notify-item">
									<i class="dripicons-lock"></i> <span>锁屏</span>
								</a>

								<!-- item-->
								<a href="javascript:void(0);" class="dropdown-item notify-item">
									<i class="dripicons-power"></i> <span>退出</span>
								</a>

							</div>
						</li>
						<li class="dropdown notification-list" style="margin-left: 10px;">
							<a href="javascript:void(0);" class="nav-link right-bar-toggle">
								<i class="mdi mdi-arrow-right-box mdi-24px"></i>
							</a>
						</li>

					</ul>

					<ul class="list-inline menu-left mb-0">
						<li class="float-left">
							<a href="#" class="logo">
								<span class="logo-lg" style="font-size: 30px;color: #05b4ac;">
                                	<!--一折通数据平台管理端-->
                                	农村业务部数据平台
                                    <!--<img src="../assets/images/logo.png" alt="" height="20">-->
                                </span>
								<span class="logo-sm">
                                    <img src="../assets/images/logo_sm.png" alt="" height="28">
                                </span>
							</a>
						</li>
						<li class="app-search">
							<form>
								<input type="text" placeholder="搜索..." class="form-control">
								<button type="submit" class="sr-only"></button>
							</form>
						</li>
					</ul>
				</div>

			</nav>
			<!-- end topbar-main -->

			<div class="topbar-menu">
				<div class="container-fluid">
					<div id="navigation">
						<!-- Navigation Menu-->
						<ul class="navigation-menu">

							<li class="has-submenu menu" id="departmentManagement" style="display: none;">
								<a href="#" id="department_link"><i class="mdi mdi-view-dashboard"></i>机构管理</a>
							</li>

							<li class="has-submenu menu active" id="roleManagement" style="display: none;">
								<a href="#" id="role_link"><i class="mdi mdi-atom"></i>角色管理</a>
							</li>

							<li class="has-submenu menu" id="staffManagement" style="display: none;">
								<a href="#" id="user_link"><i class="mdi mdi-email-outline"></i>用户管理</a>
							</li>

							<li class="has-submenu menu" id="permissionManagement" style="display: none;">
								<a href="#" id="permission_link"><i class="mdi mdi-cube-outline"></i>权限管理</a>
							</li>

							<li class="has-submenu menu" id="sourceManagement" style="display: none;">
								<a href="#" id="resource_link"><i class="mdi mdi-buffer"></i>资源管理</a>
							</li>

							<li class="has-submenu menu" id="systemManagement" style="display: none;">
								<a href="#" id="system_link"><i class="mdi mdi-file-multiple"></i>系统设置</a>
							</li>

						</ul>
						<!-- End navigation menu -->

						<div class="clearfix"></div>
					</div>
					<!-- end #navigation -->
				</div>
				<!-- end container -->
			</div>
			<!-- end navbar-custom -->
		</header>
		<!-- End Navigation Bar-->

		<div class="wrapper">
			<div class="container-fluid">

				<!-- Page title box -->
				<div class="page-title-alt-bg"></div>
				<div class="page-title-box">
					<ol class="breadcrumb float-right">
						<li class="breadcrumb-item">
							<a href="javascript:void(0);">Greeva</a>
						</li>
						<li class="breadcrumb-item">
							<a href="javascript:void(0);">Forms</a>
						</li>
						<li class="breadcrumb-item active">Form Elements</li>
					</ol>
					<h4 class="page-title">角色管理><span id=""></span></h4>
				</div>
				<!-- End page title box -->

				<div class="row">
					<div class="col-12">
						<div class="card-box">
							<h4 class="m-t-0 header-title" id="roleName"></h4>
							<p class="text-muted m-b-30 font-14" id="roleDiscribe"></p>

							<div class="row">
								<label class="col-sm-2 col-form-label">角色名称</label>
								<div class="col-sm-10">
									<input type="text" class="form-control" id="edRoleName">
								</div>
							</div>
							
							<div class="row" style="margin-top: 20px;">
								<label class="col-sm-2 col-form-label">角色描述</label>
								<div class="col-sm-10">
									<textarea class="form-control" rows="5" id="edRoleDiscribe"></textarea>
								</div>
							</div>

							<div class="row" style="margin-top: 20px;">
								<label class="col-sm-2 col-form-label">角色状态</label>
								<div class="col-sm-10">
									<input type="text" id="edDptStatus" class="form-control" readonly="" value="正常">
								</div>
							</div>
							<div class="row" style="margin-top: 20px;">
									<label class="col-sm-2 col-form-label">父级角色</label>
									<div class="col-sm-10">
										<select class="form-control">
											<option>无</option>
											<option>Admin</option>
											<option>3</option>
											<option>4</option>
											<option>5</option>
										</select>
									</div>
								</div>
							<div class="row text-center">
								<div class="col-sm-5"></div>
								<div class="col-sm-2 col-md-offset-4" style="margin-top: 50px;">
									<button class="btn btn-block btn-success waves-effect waves-light" id="submit">提 交</button>
								</div>
							</div>
							</form>

						</div>
						<!-- end card-box -->
					</div>
					<!-- end col -->
				</div>
				<!-- end row -->

			</div>
			<!-- end container -->
		</div>
		<!-- end wrapper -->

		<!-- Footer -->
		<footer class="footer">
			<div class="container-fluid">
				<div class="row">
					<div class="col-12 text-center">
						2018 © Greeva. - 更多模板：
						<a href="http://www.mycodes.net/" target="_blank">源码之家</a>
					</div>
				</div>
			</div>
		</footer>
		<!-- End Footer -->

		<!-- /Right-bar -->

		<!-- jQuery  -->
		<script src="../assets/libs/jquery/jquery.min.js"></script>
		<script src="../assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
		<script src="../assets/libs/jquery-slimscroll/jquery.slimscroll.min.js"></script>
		
		<!-- Sweet Alert Js  -->
        <script src="../assets/libs/sweetalert2/sweetalert2.min.js"></script>
        <script src="../assets/js/jquery.sweet-alert.init.js"></script>

		<!-- App js -->
		<script src="../assets/js/jquery.core.js"></script>
		<script src="../assets/js/jquery.app.js"></script>
		<script src="../assets/js/ictool.js" type="text/javascript" charset="utf-8"></script>

		<script>
			var hid = null;
			var pid = null;
			var did = null;
			var currentRole = null;
			var url = localStorage.getItem("url");
			$(document).ready(function() {
				hid = getUrlParam('hid');
				rid = getUrlParam('rid');
				pid = getCookie(hid);

				if(hid == null || pid == null) {
					window.location.href = "../jumplogin.html";
				}
				document.getElementById("department_link").href="../index.html?hid=" + hid;
				document.getElementById("role_link").href="../role.html?hid=" + hid;
				$("#userName").text(sessionStorage.getItem(hid + 'name'));

				//console.log(pid);
				//				console.log(sessionStorage.getItem(hid + 'menus'));
				var roles = sessionStorage.getItem(hid + 'roles');
				var menus = JSON.parse(sessionStorage.getItem(hid + 'menus'));
				if(menus == null || menus == "" || menus.length == 0) {
					$.ajax({
						url: url+"home/getMenu",
						data: {
							sid: pid
						},
						type: "POST",
						dataType: 'json',
						success: function(data) {
							console.log(JSON.stringify(data));
							result = JSON.parse(data);
							menus = result.menu;
						},
						error: function(er) {
							console.log(JSON.stringify(er));
						}
					});
				}

				for(var i = 0; i < menus.length; i++) {　 //数组的遍历
					if(document.getElementById(menus[i])) {
						$("ul.navigation-menu li#" + menus[i]).show();
					}
				}

				var res = JSON.parse(roles);
				if(res == null || res == "") {
					$.ajax({
						url: url+"role/get",
						data: {
							sid: pid,
							rid: rid
						},
						type: "POST",
						dataType: 'json',
						success: function(data) {
							var result = JSON.parse(data);
							if(result.status == 4) {
								window.location.href = "../jumplogin.html";
							}
							if(result.status == 5) {
								window.location.href = "../index.html?hid=" + hid;
							}
							currentRole = result.department;
						},
						error: function(er) {
							console.log(JSON.stringify(er));
						}
					});
				} else {
					for(var s = 0; s < res.length; s++) {
						var stu = res[s];
						if(stu.departmentId == did) {
							currentRole = stu;
							break;
						}
						//					alert(stu.departmentName);
					}
				}

				$("#roleName").text(currentRole.roleName);
				$("#roleDiscribe").text(currentRole.discription);
				$("#edRoleName").val(currentRole.roleName);
				$("#edRoleDiscribe").text(currentRole.discription);
			});
			
			$("#submit").click(function (){
				var updepartment = checkSumbit();
				if(updepartment == null)
					return;
				$.ajax({
						url: url+"department/update",
						data: {
							sid: pid,
							department:JSON.stringify(updepartment)
						},
						type: "POST",
						dataType: 'json',
						success: function(data) {
							var result = JSON.parse(data);
							if(result.status == 4) {
								window.location.href = "../jumplogin.html";
							}
							if(result.status == 5) {
								window.location.href = "../index.html?hid=" + hid;
							}
							if(result.status == 6) {
								swalError("没有操作权限！");
							}
							updateLocalDepartments(updepartment);
							swal(
							  '修改成功！',
							  '你修改了单位信息！',
							  'success'
							).then(function(){
								window.location.href = "../index.html?hid=" + hid;
							})
						},
						error: function(er) {
							console.log(JSON.stringify(er));
						}
					});
			});
			
			function checkSumbit(){
				var name = $("#edRoleName").val();
				var shortName = $("#edDptsName").val();
				var desctiption = $("#edRoleDiscribe").val(); 
				var status = $("#edDptStatus").val();
				if(name == ""){
					swalError("机构名不能为空");
					return null;
				}
				if(shortName == ""){
					swalError("机构简称不能为空");
					return null;
				}
				if(desctiption == ""){
					swalError("机构描述不能为空");
					return null;
				}
				if(name == currentRole.departmentName && shortName == currentRole.departmentShortName && desctiption == currentRole.departmentDescription){
					swalError("没有做任何修改");
					return null;
				}
				var department = new Object();
				department.departmentId = did;
				department.departmentName = name;
				department.departmentShortName = shortName;
				department.departmentDescription = desctiption;
				return department;
			}
			
			function updateLocalDepartments(updepartment){
				$("#edRoleName").val(updepartment.departmentName);
				$("#edRoleDiscribe").val(updepartment.departmentDescription); 
				var departments = sessionStorage.getItem(hid + 'departments');
				var res = JSON.parse(departments);
				for(var s = 0; s < res.length; s++) {
						var stu = res[s];
						if(stu.departmentId == did) {
							res[s] = updepartment;
							break;
						}
						//					alert(stu.departmentName);
					}
				sessionStorage.setItem(hid + 'departments',JSON.stringify(res));
			}
			
		</script>

	</body>

</html>